<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>移动应用 | 菜鸟进阶</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/CS-LearnRepository/logo.png">
    <link rel="manifest" href="/CS-LearnRepository/manifest.json">
    <link rel="apple-touch-icon" href="/CS-LearnRepository/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/CS-LearnRepository/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="Personal Website">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/CS-LearnRepository/assets/css/0.styles.1d31411f.css" as="style"><link rel="preload" href="/CS-LearnRepository/assets/js/app.ae6f3f76.js" as="script"><link rel="preload" href="/CS-LearnRepository/assets/js/2.1ba326f9.js" as="script"><link rel="preload" href="/CS-LearnRepository/assets/js/7.d576193f.js" as="script"><link rel="prefetch" href="/CS-LearnRepository/assets/js/10.2e5ceadb.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/100.52ab5ed3.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/101.cc544cfc.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/102.38bb05fe.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/103.ad8dc25f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/104.257fe328.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/105.1ca53594.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/106.112495f8.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/107.76552c87.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/108.3decb1c1.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/109.8195a469.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/11.4c3344a7.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/110.5446659d.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/111.483e4bba.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/112.2be2fc97.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/113.103f9302.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/114.b4853da1.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/115.b61b7ffa.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/116.0f3e8335.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/117.b43ce674.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/118.142a9ecb.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/119.c844961a.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/12.1e24409a.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/120.4950ab7b.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/121.29194c11.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/122.df8b0089.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/123.bc750af2.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/124.57b4fb51.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/125.162c7922.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/126.7c557d46.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/127.0fd666a8.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/128.0ce81f0d.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/129.b9b42849.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/13.a8788553.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/130.4b63bc72.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/131.8e5b33c0.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/132.351ac869.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/133.f721dd50.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/134.ef73c22f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/135.0168fa9d.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/136.f7963c44.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/137.0826f57a.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/138.83cb8db6.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/14.2adc07f3.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/15.c1cf2f8f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/16.824fd1cc.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/17.5cc9aa75.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/18.18f5e735.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/19.14efb2a6.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/20.8d8917ea.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/21.93499688.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/22.f9eef547.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/23.21f4ca65.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/24.06bcd4f7.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/25.cc75fd3f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/26.fe55d81f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/27.04cc9d8d.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/28.d5593707.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/29.6ae24eac.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/3.d0ce688b.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/30.6e4c58e4.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/31.71a57386.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/32.86cd035f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/33.47f825cd.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/34.7ce7068d.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/35.f1b91d69.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/36.22ffc057.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/37.4c7063b8.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/38.a2d7d6d1.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/39.72e170d1.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/4.bcd513ff.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/40.c896b7e4.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/41.c67d6883.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/42.d3f25ca5.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/43.c9d8fd17.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/44.48b09b06.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/45.62d8c8c0.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/46.d4081d7b.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/47.05c08073.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/48.6f7f50ff.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/49.e804fa12.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/5.8f5a74a9.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/50.61abf6a0.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/51.bd07e3d1.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/52.e688c802.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/53.8fdea818.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/54.e80145dd.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/55.d1499bc5.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/56.d33b6ee0.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/57.5a2fb031.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/58.5d1523b3.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/59.962b4b72.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/6.744b5cc8.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/60.37f53572.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/61.e3ce296e.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/62.fbb24cf8.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/63.2fdd5d90.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/64.c6771c06.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/65.0c4efae1.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/66.c99594bc.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/67.b241276f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/68.9818dca2.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/69.5ebf774f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/70.696953d4.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/71.537d925f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/72.529f57ce.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/73.26895b96.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/74.95bfb80a.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/75.417b0741.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/76.a2b74358.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/77.c431a1e5.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/78.cc7ddc5c.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/79.18636072.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/8.64e9f0f8.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/80.59a45e97.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/81.ea4c19bf.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/82.a4e09105.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/83.c84a5cc0.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/84.c56acd4a.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/85.9c0e5bad.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/86.9221650d.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/87.3474573c.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/88.841bf75e.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/89.de45407b.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/9.53d7237c.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/90.37ebf94c.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/91.f70bb95f.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/92.be6f1894.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/93.263999b7.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/94.f913f980.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/95.6e6c8131.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/96.b258bbf5.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/97.f0dc77c2.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/98.d2aa840c.js"><link rel="prefetch" href="/CS-LearnRepository/assets/js/99.601caf05.js">
    <link rel="stylesheet" href="/CS-LearnRepository/assets/css/0.styles.1d31411f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CS-LearnRepository/" class="home-link router-link-active"><!----> <span class="site-name">菜鸟进阶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CS-LearnRepository/frontend/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/CS-LearnRepository/backend/" class="nav-link">
  后端基础
</a></div><div class="nav-item"><a href="/CS-LearnRepository/app/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  移动应用
</a></div><div class="nav-item"><a href="/CS-LearnRepository/others/" class="nav-link">
  诗和远方
</a></div><div class="nav-item"><a href="https://github.com/cugzhaolei/CS-LearnRepository" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/CS-LearnRepository/frontend/" class="nav-link">
  前端基础
</a></div><div class="nav-item"><a href="/CS-LearnRepository/backend/" class="nav-link">
  后端基础
</a></div><div class="nav-item"><a href="/CS-LearnRepository/app/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  移动应用
</a></div><div class="nav-item"><a href="/CS-LearnRepository/others/" class="nav-link">
  诗和远方
</a></div><div class="nav-item"><a href="https://github.com/cugzhaolei/CS-LearnRepository" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>移动应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CS-LearnRepository/app/#移动应用" class="sidebar-link">移动应用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#手机应用" class="sidebar-link">手机应用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#开发难题" class="sidebar-link">开发难题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#解决方法" class="sidebar-link">解决方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#原生应用-native-app" class="sidebar-link">原生应用 native app</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#网页应用-web-app" class="sidebar-link">网页应用 web app</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#混合应用-hybrid-app" class="sidebar-link">混合应用 hybrid app</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#主流混合方案" class="sidebar-link">主流混合方案</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#hybrid技术原理" class="sidebar-link">hybrid技术原理</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#hybridapp-基础原理" class="sidebar-link">hybridapp 基础原理</a></li></ul></li><li><a href="/CS-LearnRepository/app/#各类app优缺点" class="sidebar-link">各类app优缺点</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#小程序" class="sidebar-link">小程序</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#交互原理" class="sidebar-link">交互原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#接入方案" class="sidebar-link">接入方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#优化方案" class="sidebar-link">优化方案</a></li></ul></li><li><a href="/CS-LearnRepository/app/#hybridapp-核心" class="sidebar-link">hybridAPP 核心</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/CS-LearnRepository/app/#jsbridge核心代码" class="sidebar-link">JSBridge核心代码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_1-业务方使用姿势" class="sidebar-link">1.业务方使用姿势</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_1、h5-native5通信" class="sidebar-link">1、H5-Native5通信</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#native" class="sidebar-link">Native</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_2、native-h5" class="sidebar-link">2、Native--&gt;H5</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#安卓兼容性" class="sidebar-link">安卓兼容性</a></li></ul></li><li><a href="/CS-LearnRepository/app/#建造大楼-协议的定制" class="sidebar-link">建造大楼 --- 协议的定制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#功能协议" class="sidebar-link">功能协议</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_1-初始化机制" class="sidebar-link">1.初始化机制</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_2-包更新机制" class="sidebar-link">2.包更新机制</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_3-环境系统-和-多语言系统" class="sidebar-link">3.环境系统 和 多语言系统</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_4-事件中转站" class="sidebar-link">4. 事件中转站</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_5-数据传递机制" class="sidebar-link">5. 数据传递机制</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_6-代理请求" class="sidebar-link">6. 代理请求</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#_7-更多" class="sidebar-link">7.更多</a></li><li class="sidebar-sub-header"><a href="/CS-LearnRepository/app/#业务协议" class="sidebar-link">业务协议</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="移动应用"><a href="#移动应用" class="header-anchor">#</a> 移动应用</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>移动开发也称为手机开发，或叫做移动互联网开发。是指以手机、PDA、UMPC等便携终端为基础，进行相应的开发工作，由于这些随身设备基本都采用无线上网的方式，因此，业内也称作为无线开发。</li> <li>移动开发根据宿主环境和可以分为三种类型</li></ul></div> <h2 id="手机应用"><a href="#手机应用" class="header-anchor">#</a> 手机应用</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>目前手机应用与电脑应用各有千秋，但是在针对电商等领域，移动端的用户量已经越来越多</li></ul></div> <h2 id="开发难题"><a href="#开发难题" class="header-anchor">#</a> 开发难题</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>手机操作系统种类繁多 一套系统想要在多平台兼容需要大量开发人员</li> <li>移动开发较为困难：手机种类繁多、成本较高</li></ul></div> <h2 id="解决方法"><a href="#解决方法" class="header-anchor">#</a> 解决方法</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>无线中间件</li> <li><ol><li>跨平台：中间件系统都号称跨平台，一次开发，可以适用于不同的平台。</li></ol></li> <li><ol start="2"><li>门槛高：用WEB开发技术（HTML+JS+CSS) 开发移动应用，极大地降低了门槛，提高了效率。</li></ol></li> <li><ol start="3"><li>公司转型：软件和互联网公司利用中间件系统开发移动应用，完全是在发挥原有的长处，而无需投入任何资源学习新知识。</li></ol></li> <li><ol start="4"><li>专业的人做专业的事：无线中间件（移动中间件）的原理就是把原生的功能封装打包成简单的API，开发人员只需要了解调用这些API的方法，即可完成移动开发。</li></ol></li></ul></div> <h2 id="原生应用-native-app"><a href="#原生应用-native-app" class="header-anchor">#</a> 原生应用 native app</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>百度百科的定义：基于智能手机本地操作系统如iOS、Android、WP并使用原生程式编写运行的第三方应用程序，一般开发的语言为Java、C++等。在使用上的具体表现就是，手机桌面上的图标点进去基本就是native app了。</li></ul></div> <h2 id="网页应用-web-app"><a href="#网页应用-web-app" class="header-anchor">#</a> 网页应用 web app</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>百度百科的定义：基于web的系统和应用，运行于网络和浏览器之上，目前多采用h5标准开发。在使用上的具体表现是，手机浏览器点击进入，会有一些应用的小图标，这些小图标在点击后，在浏览器里加载的页面 跟你直接下载一个app后打开的页面是相同的，这些小图标代表的就是web app。</li></ul></div> <blockquote><hr></blockquote> <p>来源：郭东东</p> <p>https://segmentfault.com/a/1190000015678155</p> <blockquote><hr></blockquote> <h2 id="混合应用-hybrid-app"><a href="#混合应用-hybrid-app" class="header-anchor">#</a> 混合应用 hybrid app</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>Hybrid App主要以JS+Native两者相互调用为主，从开发层面实现“一次开发，多处运行”的机制，成为真正适合跨平台的开发。Hybrid App兼具了Native App良好用户体验的优势，也兼具了Web App使用HTML5跨平台开发低成本的优势。</li></ul> <p>目前已经有众多Hybrid App开发成功应用，比如美团、爱奇艺、微信等知名移动应用，都是采用Hybrid App开发模式。</p></div> <h3 id="主流混合方案"><a href="#主流混合方案" class="header-anchor">#</a> 主流混合方案</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>基于 WebView UI 的基础方案，市面上大部分主流 App 都有采用，例如微信JS-SDK，通过 JSBridge 完成 H5 与 Native 的双向通讯，从而赋予H5一定程度的原生能力。</li> <li>基于 Native UI 的方案，例如 React-Native、Weex。在赋予 H5 原生API能力的基础上，进一步通过 JSBridge 将js解析成的虚拟节点树(Virtual DOM)传递到 Native 并使用原生渲染。</li> <li>另外还有近期比较流行的小程序方案，也是通过更加定制化的 JSBridge，并使用双 WebView 双线程的模式隔离了JS逻辑与UI渲染，形成了特殊的开发模式，加强了 H5 与 Native 混合程度，提高了页面性能及开发体验。</li></ul></div> <h3 id="hybrid技术原理"><a href="#hybrid技术原理" class="header-anchor">#</a> hybrid技术原理</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>-Hybrid App的本质，其实是在原生的 App 中，使用 WebView 作为容器直接承载 Web页面。因此，最核心的点就是 Native端 与 H5端 之间的双向通讯层，其实这里也可以理解为我们需要一套跨语言通讯方案，来完成 Native(Java/Objective-c/...) 与 Java 的通讯。这个方案就是我们所说的 JSBridge，而实现的关键，便是作为容器的 WebView，一切的原理都是基于 WebView 的机制。</p></div> <h3 id="hybridapp-基础原理"><a href="#hybridapp-基础原理" class="header-anchor">#</a> hybridapp 基础原理</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>Java 通知 Native</li> <li>Native 通知 Java</li> <li>JSBridge 的接入</li> <li>H5 的接入</li></ul></div> <h2 id="各类app优缺点"><a href="#各类app优缺点" class="header-anchor">#</a> 各类app优缺点</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <table><thead><tr><th style="text-align:right;">特性</th> <th style="text-align:center;">webapp</th> <th style="text-align:center;">hybridapp</th> <th style="text-align:left;">nativeapp</th></tr></thead> <tbody><tr><td style="text-align:right;">开发成本</td> <td style="text-align:center;">低</td> <td style="text-align:center;">中</td> <td style="text-align:left;">高</td></tr> <tr><td style="text-align:right;">维护更新</td> <td style="text-align:center;">简单</td> <td style="text-align:center;">简单</td> <td style="text-align:left;">复杂</td></tr> <tr><td style="text-align:right;">体验</td> <td style="text-align:center;">差</td> <td style="text-align:center;">中</td> <td style="text-align:left;">优</td></tr> <tr><td style="text-align:right;">商城认可</td> <td style="text-align:center;">认可</td> <td style="text-align:center;">不认可</td> <td style="text-align:left;">认可</td></tr> <tr><td style="text-align:right;">安装</td> <td style="text-align:center;">不需要</td> <td style="text-align:center;">需要</td> <td style="text-align:left;">需要</td></tr> <tr><td style="text-align:right;">跨平台</td> <td style="text-align:center;">优</td> <td style="text-align:center;">优</td> <td style="text-align:left;">差</td></tr></tbody></table></div> <h2 id="小程序"><a href="#小程序" class="header-anchor">#</a> 小程序</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>通过更加定制化的 JSBridge，赋予了 Web 更大的权限，并使用双 WebView 双线程的模式隔离了 JS逻辑 与 UI渲染，形成了特殊的开发模式，加强了 H5 与 Native 混合程度，属于第一种方案的优化版本；</li> <li>优势: 用户体验好于常规 Webview 方案，且通常依托的平台也能提供更为友好的开发调试体验以及功能；</li> <li>劣势: 需要依托于特定的平台的规范限定</li></ul></div> <h2 id="交互原理"><a href="#交互原理" class="header-anchor">#</a> 交互原理</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Hybrid技术 中最核心的点就是 Native端 与 H5端 之间的 双向通讯层，其实这里也可以理解为我们需要一套 跨语言通讯方案，便是我们常听到的 JSBridge。</p> <ul><li><p>JavaScript 通知 Native</p> <ul><li><p>API注入，Native 直接在 JS 上下文中挂载数据或者方法</p> <ul><li>延迟较低，在安卓4.1以下具有安全性问题，风险较高</li></ul></li> <li><p>WebView URL Scheme 跳转拦截</p> <ul><li>兼容性好，但延迟较高，且有长度限制</li></ul></li> <li><p>WebView 中的 prompt/console/alert拦截(通常使用 prompt)</p></li></ul></li> <li><p>Native 通知 Javascript:</p> <ul><li>IOS: stringByEvaluatingJavaScriptFromString</li></ul> <div class="language-Swift line-numbers-mode"><pre class="language-swift"><code>webview<span class="token punctuation">.</span><span class="token function">stringByEvaluatingJavaScriptFromString</span><span class="token punctuation">(</span><span class="token string">&quot;alert('NativeCall')&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Android: loadUrl (4.4-)</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 调用js中的JSBridge.trigger方法</span>
<span class="token comment">// 该方法的弊端是无法获取函数返回值；</span>
webView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">&quot;javascript:JSBridge.trigger('NativeCall')&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>Android: evaluateJavascript (4.4+)</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 4.4+后使用该方法便可调用并获取函数返回值；</span>
mWebView<span class="token punctuation">.</span>evaluateJavascript（<span class="token string">&quot;javascript:JSBridge.trigger('NativeCall')&quot;</span><span class="token punctuation">,</span> 	 <span class="token keyword">new</span> <span class="token class-name">ValueCallback</span><span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    @Override
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceiveValue</span><span class="token punctuation">(</span><span class="token parameter">String value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//此处为 js 返回的结果</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul></div> <h2 id="接入方案"><a href="#接入方案" class="header-anchor">#</a> 接入方案</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>整套方案需要 Web 与 Native 两部分共同来完成:</p> <ul><li>Native: 负责实现URL拦截与解析、环境信息的注入、拓展功能的映射、版本更新等功能；</li> <li>JavaScirpt: 负责实现功能协议的拼装、协议的发送、参数的传递、回调等一系列基础功能。</li></ul> <p>接入方式：</p> <ul><li><p>在线H5: 直接将项目部署于线上服务器，并由客户端在 HTML 头部注入对应的 Bridge。</p> <ul><li>优势: 接入/开发成本低，对 App 的侵入小；</li> <li>劣势: 重度依赖网络，无法离线使用，首屏加载慢；</li></ul></li> <li><p>内置离线包: 将代码直接内置于 App 中，即本地存储中，可由 H5 或者 客户端引用 Bridge。</p> <ul><li>优势: 首屏加载快，可离线化使用；</li> <li>劣势: 开发、调试成本变高，需要多端合作，且会增加 App 包体积</li></ul></li></ul></div> <h3 id="优化方案"><a href="#优化方案" class="header-anchor">#</a> 优化方案</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><p>Webview 预加载: Webview 的初始化其实挺耗时的。我们测试过，大概在100~200ms之间，因此如果能前置做好初始化于内存中，会大大加快渲染速度。</p></li> <li><p>更新机制: 使用离线包的时候，便会涉及到本地离线代码的更新问题，因此需要建立一套云端下发包的机制，由客户端下载云端最新代码包 (zip包)，并解压替换本地代码。</p> <ul><li>增量更新: 由于下发包是一个下载的过程，因此包的体积越小，下载速度越快，流量损耗越低。只打包改变的文件，客户端下载后覆盖式替换，能大大减小每次更新包的体积。</li> <li>条件分发: 云平台下发更新包时，可以配合客户端设置一系列的条件与规则，从而实现代码的条件更新:
<ul><li>单 地区 更新: 例如一个只有中国地区才能更新的版本；</li> <li>按 语言 更新: 例如只有中文版本会更新；</li> <li>按 App 版本 更新: 例如只有最新版本的 App 才会更新；</li> <li>灰度 更新: 只有小比例用户会更新；</li> <li>AB测试: 只有命中的用户会更新；</li></ul></li></ul></li> <li><p>降级机制: 当用户下载或解压代码包失败时，需要有套降级方案，通常有两种做法:</p> <ul><li>本地内置: 随着 App 打包时内置一份线上最新完整代码包，保证本地代码文件的存在，资源加载均使用本地化路径；</li> <li>域名拦截: 资源加载使用线上域名，通过拦截域名映射到本地路径。当本地不存在时，则请求线上文件，当存在时，直接加载；</li></ul></li> <li><p>跨平台部署: Bridge层 可以做一套浏览器适配，在一些无法适配的功能，做好降级处理，从而保证代码在任何环境的可用性，一套代码可同时运行于 App内 与 普通浏览器；</p></li> <li><p>环境系统: 与客户端进行统一配合，搭建出 正式 / 预上线 / 测试 / 开发环境，能大大提高项目稳定性与问题排查；</p></li> <li><p>开发模式:</p> <ul><li>能连接PC Chrome/safari 进行代码调试；</li> <li>具有开发调试入口，可以使用同样的 Webview 加载开发时的本地代码；</li> <li>具备日志系统，可以查看 Log 信息；</li></ul></li></ul></div> <h2 id="hybridapp-核心"><a href="#hybridapp-核心" class="header-anchor">#</a> <a href="https://github.com/xd-tayde/blog/blob/master/hybrid-2.md" target="_blank" rel="noopener noreferrer">hybridAPP 核心<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <h2 id="jsbridge核心代码"><a href="#jsbridge核心代码" class="header-anchor">#</a> JSBridge核心代码</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <h3 id="_1-业务方使用姿势"><a href="#_1-业务方使用姿势" class="header-anchor">#</a> 1.业务方使用姿势</h3> <p><img src="/images/hybrid-6.png" alt="hybrid2native"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Bridge<span class="token punctuation">.</span><span class="token function">nativeCall</span><span class="token punctuation">(</span><span class="token string">'getNetwork'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//无网络状态</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">//type：wifi/2g/3g/4g</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div> <h3 id="_1、h5-native5通信"><a href="#_1、h5-native5通信" class="header-anchor">#</a> 1、H5-Native5通信</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>nativeCall内部实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">nativeCall</span><span class="token punctuation">(</span><span class="token parameter">scheme <span class="token operator">=</span> <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>params<span class="token punctuation">,</span>callBack</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//对参数进行字符串化，并进行编码</span>
    parmas <span class="token operator">=</span> params<span class="token operator">?</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">''</span>

    <span class="token comment">//生成唯一handler标识</span>
    <span class="token keyword">const</span> handler <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
    handlerKey <span class="token operator">=</span> <span class="token function">getHandlerKey</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//将参数存储进参数池</span>
    _paramsStore<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>handlerKey<span class="token punctuation">.</span>p<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isFn</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//将回调存储金回调池</span>
        _callbackStore<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>handlerKey<span class="token punctuation">.</span>c<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//注册自定义事件，并绑定回调</span>
        <span class="token comment">//回调会在接收到postMessage时触发执行</span>
        <span class="token function">addEvent</span><span class="token punctuation">(</span>handlerKey<span class="token punctuation">.</span>e<span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">,</span>handler<span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token comment">//完成一次完整交互时，将该自定义事件解绑</span>
            <span class="token function">removeEvent</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
            <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>MTJs<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scheme<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?handler=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>handler<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>上述代码构建过程</p> <ul><li>生成唯一handler标识，从0开始增加</li> <li>将参数按handler值的规则存入参数池(_paramsStore)</li> <li>以handler注册自定义事件，绑定callback，并将callback也写入——callbackStore中，addEvent().存储的目的主要是为了事件解绑时使用</li> <li>以iframe的形式发送协议，并携带唯一标志handler，send();</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//发送协议</span>
<span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token parameter">scheme</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">//创建iframe</span>
        <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> scheme<span class="token punctuation">;</span>
        iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//延迟删除节点</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            iframe<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="native"><a href="#native" class="header-anchor">#</a> Native</h3> <ul><li>客户端接收到请求后，会使用 handler 调用 getParam 从参数池中获取对应的参数。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getParam</span><span class="token punctuation">(</span><span class="token parameter">handler<span class="token operator">=</span><span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> key  <span class="token operator">=</span> <span class="token function">getHandlerKey</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">.</span>p<span class="token punctuation">;</span>
    <span class="token keyword">return</span> _paramStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>执行协议对应的功能；</li></ul> <p>这样即走通了 H5 --&gt; Native 的这个流程，在客户端完成了对应的功能后，既开始回传执行结果。</p> <h3 id="_2、native-h5"><a href="#_2、native-h5" class="header-anchor">#</a> 2、Native--&gt;H5</h3> <h4 id="native-2"><a href="#native-2" class="header-anchor">#</a> Native</h4> <ul><li>Native 完成功能后，直接调用 Bridge.postMessage(handler, data)，将 执行结果 和 之前 nativeCall 传过来的标识回传给 H5；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//客户端携带hanlder和data调用postMessage；</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>handler，data<span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token comment">//获取对应的自定义事件名 e_handler</span>
    <span class="token keyword">const</span> evName <span class="token operator">=</span> <span class="token function">getHandlerKey</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">.</span>e<span class="token punctuation">;</span>
    <span class="token comment">//创建并触发自定义事件</span>
    <span class="token function">fireEvent</span><span class="token punctuation">(</span>evName<span class="token punctuation">,</span>e<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="h5"><a href="#h5" class="header-anchor">#</a> H5</h4> <ul><li>H5 在接收到唯一标识后初始化对应的自定义事件，挂载数据后触发，这里涉及的就是 fireEvent 这个函数:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fireEvent</span><span class="token punctuation">(</span><span class="token parameter">evName<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//创建自定义事件对象</span>
    <span class="token keyword">let</span> evenItem<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isFn</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>CustomEvent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        eventItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">doc<span class="token punctuation">.</span>CustomEvent</span><span class="token punctuation">(</span>evName<span class="token punctuation">,</span><span class="token punctuation">{</span>
            bubbles<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
            cancelable<span class="token operator">:</span><span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isFn</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createEvent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        eventItem <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">'Event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        eventItem<span class="token punctuation">.</span><span class="token function">initEvent</span><span class="token punctuation">(</span>evName<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//将数据挂载到事件对象中</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token operator">&amp;&amp;</span>eventItem<span class="token punctuation">)</span><span class="token punctuation">{</span>
        eventItem<span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//触发自定义事件</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>eventItem<span class="token punctuation">)</span><span class="token punctuation">{</span>
        win<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>eventItem<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Bridge Error:dispatchEvent'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>这样，我们就已经完成了双端之间的双向交互机制了，梳理出了整个 bridge.js 的核心代码了，包含了：</p> <ul><li><p>最重要的开放API: nativeCall 与 postMessage ；</p></li> <li><p>客户端获取参数函数: getParam ；</p></li> <li><p>事件回调系统中的 addEvent 和 fireEvent ；</p></li> <li><p>用于发送协议的 send。</p></li></ul></div> <h3 id="安卓兼容性"><a href="#安卓兼容性" class="header-anchor">#</a> 安卓兼容性</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果看过上一篇原理篇的童鞋，这时可能会有个疑问：在 Android 4.4以下时，使用的 loadUrl 进行 js 函数的调用，而此时是无法获取函数的返回值的，也就是说4.4- 时，安卓并无法通过 getParam 这个函数来获取到协议的参数，这里需要做兼容性的处理，而我们这里可以使用一个曲线救国的骚操作，使用到的原理就是上一篇文章中有提到的另一种 H5 -&gt; Native 的方案：</p></div> <h4 id="webview-中的-prompt-拦截"><a href="#webview-中的-prompt-拦截" class="header-anchor">#</a> webView 中的 prompt 拦截</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>方案如下:</p> <ul><li>当安卓接受到协议，并拿到 handler 值；</li> <li>使用无兼容性问题的 loadUrl 执行 js：Bridge.getParam(handler) ，直接将返回值直接通过 js 中的 prompt 发出：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>webview<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">&quot;javascript:prompt('Bridge:commonJsExecute#1'),Bridge.getParam(1))&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>通过重写 onJsPrompt 这个方法，拦截上一步发出的 prompt 的内容，并解析出相应的参数；</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onJsPrompt</span><span class="token punctuation">(</span><span class="token class-name">WebView</span> webView<span class="token punctuation">,</span><span class="token class-name">String</span> url<span class="token punctuation">,</span><span class="token class-name">String</span> message<span class="token punctuation">,</span><span class="token class-name">String</span> defaultValue<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//获取params内容message</span>
    <span class="token comment">//匹配解析出对应的参数字符串，并解析</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过这样的方式，安卓全平台都可以完成参数的获取，并且方式统一，不需要分平台兼容，这就非常的skrskr啦。~~🤘🏻🤘🏻</p></div> <h2 id="建造大楼-协议的定制"><a href="#建造大楼-协议的定制" class="header-anchor">#</a> 建造大楼 --- 协议的定制</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在完成最基础的架构后，我们就可以开始来进一步完成一些上层建筑了，制定一系列真正开放给业务方使用的协议 API，完善整套方案。</p> <p>首先我们可以将这些协议分成<b> 功能协议</b> 和<b> 业务协议</b>。</p> <h3 id="功能协议"><a href="#功能协议" class="header-anchor">#</a> 功能协议</h3> <p>这类协议是指用于完善整套方案的基础功能的一些通用协议，以command://作为通用头，封装在 SDK 之中，可以在全线 App、全线 WebView 中使用：</p> <h3 id="_1-初始化机制"><a href="#_1-初始化机制" class="header-anchor">#</a> 1.初始化机制</h3> <p>上篇文章有提到由于 bridge.js 注入的异步性，我们需要由客户端在注入完成后通知 H5。</p> <p>这里我们可以约定一个<b>通用的初始化事件</b>，这里我们约定为 <em>init</em>，因此前端就可以进行入口的监听, 类似于我们常用的 DOMContentLoaded:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> isLoaded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventLister</span><span class="token punctuation">(</span><span class="token string">'_init_'</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>isLoaded<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    isLoaded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">//代码逻辑</span>
    <span class="token comment">//..</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>大家可以看到，这里用了个标记位用于<b>避免事件被重复触发</b>，这是由于客户端中是通过监听 WebView 的生命周期钩子来触发的，而 iframe 之类的操作会导致这些钩子的多次触发，因此需要双方各做一层防御性措施。</p> <p>接下来，我们可以通过该事件，直接初始化传给H5一些<b>环境参数和系统信息</b>等，下面是我们使用到的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>e<span class="token punctuation">.</span>data<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">//应用名</span>
    name<span class="token operator">:</span><span class="token string">'appname'</span><span class="token punctuation">,</span>
    <span class="token comment">//app version</span>
    appVersion<span class="token operator">:</span><span class="token string">'0.0.1'</span><span class="token punctuation">,</span>
    <span class="token comment">//H5 版本</span>
    version<span class="token operator">:</span><span class="token string">'0.0.1'</span><span class="token punctuation">,</span>
    <span class="token comment">//平台 1：ios 2:android</span>
    platform<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token comment">//地区</span>
    area<span class="token operator">:</span><span class="token string">'中国'</span><span class="token punctuation">,</span>
    <span class="token comment">//language '</span>
    language<span class="token operator">:</span><span class="token string">'zh-CN'</span><span class="token punctuation">,</span>
    <span class="token comment">//当前APP环境 0：release 1:pre; 2:dev</span>
    env<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token comment">//参数池</span>
    data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>同样的，我们可以<b>约定更多的页面生命周期事件</b>，例如因为App很经常性的隐藏到后台，因此在被激活时，我们可以设置个生命周期: <em>resume</em>，可以用于告知 H5 页面被激活。</p> <p>Tips: 这里就能体现出我们通过<b>事件机制</b>来作为回调系统的优势了，我们可以以最习惯的方式进行事件的监听，而客户端可以直接使用 bridge.fireEvent('<em>init</em>', data)触发事件，这样便可以优雅地实现 <b>Native -&gt; H5 的单方向交互</b>。</p> <h3 id="_2-包更新机制"><a href="#_2-包更新机制" class="header-anchor">#</a> 2.包更新机制</h3> <p>Hybrid模块 的其中一种方式是将前端代码打包后内置于 App 本地，以便拥有最快的启动性能和离线访问能力。而这种方式最大的麻烦点，就是代码的更新，我们不可能每次有修改时就手动重新打包给客户端童鞋替换，而且这样也失去了我们的热更新机制。</p> <p>因此这里就需要一套新的<b>热更新机制</b>，这套机制需要由<b>客户端/前端/服务端</b> 三端的童鞋提供对应的资源，共同协作完成整套流程。</p> <h4 id="资源"><a href="#资源" class="header-anchor">#</a> 资源</h4> <ul><li>H5: 每个代码包都有一个<b>唯一且递增的版本号</b>；</li> <li>Native: 提供<b>包下载且解压到对应目录</b>的服务，前端可以由下面这个协议来调用该功能。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Bridge<span class="token punctuation">.</span><span class="token function">nativeCall</span><span class="token punctuation">(</span><span class="token string">'downloadModule'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token comment">//APP name</span>
    module<span class="token operator">:</span>appName<span class="token punctuation">,</span>
    <span class="token comment">//最新包线上地址</span>
    url<span class="token operator">:</span>zipUrl<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>服务端: 提供一个接口，可以获取线上最新代码包的版本号和下载地址。</li></ul> <h4 id="流程"><a href="#流程" class="header-anchor">#</a> 流程：</h4> <ul><li>前端更新代码打包后按版本号上传至指定的服务器上；</li> <li>每次打开页面时，H5请求接口获取线上最新代码包版本号，并与本地包进行版本号比对，当线上的版本号 大于 本地包版本号时，发起包下载协议：</li> <li>客户端接收到协议后，直接去线上地址下载最新的代码包，并解压替换到当前目录文件。
拥有这样的机制后，H5在开发后，就可以直接打包将包上传到对应的服务器上，这样在 App 中打开页面后，即可以实时的热更新。</li></ul> <h3 id="_3-环境系统-和-多语言系统"><a href="#_3-环境系统-和-多语言系统" class="header-anchor">#</a> 3.环境系统 和 多语言系统</h3> <p>通常，我们会将项目分成多个不同的环境，相互隔离。而由于 Hybrid 模块是置于 App 中的，因此环境需要与 App 进行匹配，这里就可以直接使用上面第一点提到的，通过 <em>init</em> 中携带的数据data.env来匹配：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>env<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">-</span> 正式环境； <span class="token number">1</span> <span class="token operator">-</span> 测试环境； <span class="token number">2</span> <span class="token operator">-</span> 开发环境；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>同理， 多语言也可以直接使用 e.data.language 直接进行匹配；</p> <p>Tips：
环境机制我们通常主要用于匹配后端的环境，正式环境和测试环境对应不同的接口。而这里还有一点特别的，就是需要注意代码包的更新，上述的包更新条件要包含三个方面:<b> 版本号、环境和 App版本</b>，在不同环境不同 App 版本下，也应该更新到相应的最新代码包。</p> <h3 id="_4-事件中转站"><a href="#_4-事件中转站" class="header-anchor">#</a> 4. 事件中转站</h3> <p>由于页面是 H5 开发，而 Native 可能需要控制 H5 页面，例如最常用的场景:</p> <p>当页面中有弹窗或者SPA切换页面时，<b>安卓的返回实体键</b>应该能完成对应的回退，而不是因为 WebView 没有 history 就直接关闭。</p> <p>类似于这类需求，这里就可以定制一个<b>事件中心(<em>eventListeners</em> )</b>，用于监听客户端的实体返回键：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//事件中心</span>
<span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token string">'_eventListeners_'</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> type <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type
    <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span><span class="token operator">:</span><span class="token string">'back'</span><span class="token operator">:</span>
            <span class="token comment">//关闭弹窗：this.closeDialog();</span>
            <span class="token comment">//返回页面:this.goLastPage();</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span><span class="token operator">:</span><span class="token string">'hideLoading'</span><span class="token operator">:</span>
            <span class="token comment">//y隐藏loading：this.hideLoading()</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_5-数据传递机制"><a href="#_5-数据传递机制" class="header-anchor">#</a> 5. 数据传递机制</h3> <p>在业务中，很多场景需要做到 Native 与 H5 保持数据的同步，此时就可以使用类似上面的原理，制定一套数据传递协议:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//推送数据</span>
<span class="token function">Bridge。naticeCall</span><span class="token punctuation">(</span><span class="token string">'putData'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
    c<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//监听数据通道</span>
<span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token string">'getData'</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//type:代表数据类型，可自定义</span>
    <span class="token comment">//data:数据</span>
    <span class="token keyword">const</span><span class="token punctuation">{</span>type<span class="token punctuation">,</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span><span class="token operator">:</span><span class="token string">'list'</span><span class="token operator">:</span>
            <span class="token comment">//获取客户端传递过来的列表数据</span>
            <span class="token comment">// ... </span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Tips：</p> <p>Hybrid模块通常需要从对应的入口进入，因此这里有一种可以优化的方式：</p> <p><b>由 App 在启动时先去获取线上数据，在进入 WebView 后直接通过 <em>init</em> 或者触发 getData 直接发送给 H5</b>，这样能减少请求数量，优化用户体验。</p> <h3 id="_6-代理请求"><a href="#_6-代理请求" class="header-anchor">#</a> 6. 代理请求</h3> <p>H5中最常用的就是请求，通常我们可以直接使用ajax，但是这里有几个问题比较棘手:</p> <ul><li>最常见的请求跨域；</li> <li>数据算法加密；</li> <li>用户登录校验；</li></ul> <p>而客户端的请求便不会出现这些问题，因此我们可以由客户端代理我们发出的请求，可以定制4个协议: getProxy，postProxy， getProxyLogined，postProxyLogined，其中带有 Logined 的协议代表着在请求时会自动<b>携带已登录用户的 token 和 uid 等参数</b>，使用在一些需要登录信息的接口上。这样做的好处是</p> <ul><li>H5 方就无需处理繁多的各项复杂信息，不需要进行跨端传输；</li> <li>能够对 H5 与 Native 的请求出口进行统一，方便加工处理.</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Bridge<span class="token punctuation">.</span><span class="token function">naiveCall</span><span class="token punctuation">(</span><span class="token string">'getProxy'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    url<span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
    headers<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code<span class="token operator">==</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//请求失败</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">//请求成功 返回数据e.data</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_7-更多"><a href="#_7-更多" class="header-anchor">#</a> 7.更多</h3> <p>除了这些重要的功能外，我们还可以非常自由地定制很多协议，让 H5 拥有更多更强大的功能，下面是我们所定制的一些功能：</p> <ul><li>getNetwork：获取网络状态；</li> <li>openApp：唤起其它 App；</li> <li>setShareInfo与callShare：分享内容到第三方平台；</li> <li>link：使用新的 WebView 打开页面；</li> <li>closeWebview：关闭 WebView；</li> <li>setStorage 与 getStorage：设置与获取缓存数据；</li> <li>loading：调用客户端通用 Loading；</li> <li>setWebviewTitle：设置 WebView 标题；</li> <li>saveImage：保存图片到本地；
...
这里可以定义更多的通用性协议，这里有个原则可以遵守，即这部分协议应该是<b>基础性功能，应该是纯净的，适用于所有的业务方</b>。根据上篇文章提到的理念，这部分是当成通用 SDK 进行维护与升级的，因此不应该耦合业务层的任何逻辑。</li></ul> <p>而有时我们会遇到需要定制一些业务上的逻辑，例如上面提到的项目中，我们要将用户图片通过算法处理成卡通画。这样的需求就是非常的业务化，不适用于其它项目，因此我们应该定制成业务协议。</p></div> <h3 id="业务协议"><a href="#业务协议" class="header-anchor">#</a> 业务协议</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这类协议区别于功能协议，它们会杂合一定程度的业务逻辑，而这些逻辑只是针对于特定的项目。其实对于 H5 的使用上，差别并不大，只是使用对应特殊的协议头用于区分，例如:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Bridge<span class="token punctuation">.</span><span class="token function">nativeCall</span><span class="token punctuation">(</span><span class="token string">'app://getResultImgae'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    category_id<span class="token punctuation">,</span>
    matrail_id<span class="token operator">:</span>materialId<span class="token punctuation">,</span>
    subcat_id<span class="token operator">:</span>subcatId<span class="token punctuation">,</span>
    origin_img<span class="token punctuation">,</span>
    zip_url<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//获取处理后的效果图路径</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这类协议通常不包含在 SDK 中，因此需要由客户端的童鞋针对项目的 WebView 进行定制，使用 bridge.js 提供的基础功能实现对应的复杂功能。而在其它的项目入口中，就无法使用这些协议。</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/24/2020, 10:46:46 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/CS-LearnRepository/assets/js/app.ae6f3f76.js" defer></script><script src="/CS-LearnRepository/assets/js/2.1ba326f9.js" defer></script><script src="/CS-LearnRepository/assets/js/7.d576193f.js" defer></script>
  </body>
</html>
