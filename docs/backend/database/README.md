
# 数据库相关


## 数据库设计模式

1. 主拓展模式

一般应用于提取不同类型的对象的共同特征，比如在学校中，课程包含老师、学生;工厂有产品、人员。对于上面系统的设计设计人员表：user、teacher、student的单独成表。维护同样的userid同时作为二者主键。称为1对1关系。这被称为主扩展模式。

扩展表的主键既是扩展表的主键也是主表的外键

2. 主从模式

主从模式的应用场景最多。是典型的一对多的关系。比如贴吧的实现，整个
吧就是一个主表。而贴吧有许多的从表就是不同楼主发的帖子，而每个帖子有用很多从表
那就是每个楼所对应的信息。

3. 名值关系
　　主要处理系统设计阶段还不能完全确定的属性的对象。这些对象的属性在系统运
行时会有很大的变更，或者是多个对象之间的属性存在很大的差异。
　　比如说一个学生的表，记录了一些学生必须有的属性：年龄身高体重姓名什么的。但是突然有
一天有一个人穿越了，他就需要一个剑术值的数据。通常需要额外两个表来存储这种不确定是否
会用会有的属性。

　　首先需要一个属性模版表，就是不管这个属性属于谁，属于何物，何时，
我只是证明有这么一条额外属性而存在。那么上述的例子当中，属性模板表当中就
需要添加一条属性：（属性代码一般给属性分类用）

　　ID 1 属性代码 1001 属性名称 剑术值

　　但是具体剑术值是多少，这个表不去讨论。存储数据的表称为额外属性表，这个
表存储的字段分别标识
   1. 这条数据属于哪个人、物（角色id）
   2. 这条数据是什么属性 （属性模板ID）
   3. 属性的具体值是多少 （data)

4. 多对多关系
      多对多模式，也是比较常见的一种数据库设计模式，它所描述的两个对象不分主
次、地位对等、互为一对多的关系。对于A表来说，一条记录对应着B表的多条记录，反过
来对于B表来说，一条记录也对应着A表的多条记录，这种情况就是“多对多模式”。
这个主要可以细分成两种情况。取决于关联表有没有业务需求。 

### [数据库设计范式](https://www.cnblogs.com/wsg25/p/9615100.html)

目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。

而通常我们用的最多的就是第一范式（1NF）、第二范式（2NF）、第三范式（3NF），也就是本文要讲的“三大范式”。

第一范式（1NF）：要求数据库表的每一列都是不可分割的原子数据项。

举例说明：

学号|姓名|性别|年龄|家庭|学校
--:|:--:|:--:|:--:|:--:|:--
20191001001|xx|female|24|北京|研二、me
20191001002|xx|male|24|3口人、上海|研二、me
20191001003|xx|female|25|4口人、武汉|研三、ee
20191001004|xx|female|22|3口人、广州|研一、cs

上面表中的"家庭"、"学校"均不满足第一范式。因此调整如下：
学号|姓名|性别|年龄|家庭人口|专业|年级
--:|:--:|:--:|:--:|:--:|:--:|:--
20191001001|xx|female|24|5口人|me|研二|me
20191001002|xx|male|24|3口人|me|研二|me
20191001003|xx|female|25|4口人|mee|研三|ee
20191001004|xx|female|22|3口人|cs|研一|cs

第二范式（2NF）：在1NF的基础上，非码属性必须完全依赖于候选码（在1NF基础上消除非主属性对主码的部分函数依赖）

第二范式需要确保数据库表中的每一列都和主键相关，而不能只与主键的某一部分相关（主要针对联合主键而言）。

订单号|产品号|产品数量|产品折扣|产品价格|订单金额|订单时间
--:|:--:|:--:|:--:|:--:|:--:|:--
2008003|205|100|0.9|8.9|2870|20080103
2008003|206|200|0.8|9.9|2870|20080103
2008005|206|500|0.75|10|2870|20080103
2008006|206|400|0.88|9|2870|20080103
2008008|209|1000|0.95|8|14|2870|20080203
2008008|210|140|0.95|8|2870|20080213
2008008|211|350|0.9|10.9|2870|20080403
![](/images/database-design-formula-2-.png)

在上图所示的情况中，同一个订单中可能包含不同的产品，因此主键必须是“订单号”和“产品号”联合组成，

但可以发现，产品数量、产品折扣、产品价格与“订单号”和“产品号”都相关，但是订单金额和订单时间仅与“订单号”相关，与“产品号”无关，

这样就不满足第二范式的要求，调整如下，需分成两个表：


![](/images/database-design-formula-2.png) 
![](/images/database-design-formula-2-2.png)

第三范式（3NF）：在2NF基础上，任何非主属性不依赖于其它非主属性（在2NF基础上消除传递依赖）

第三范式需要确保数据表中的每一列数据都和主键直接相关，而不能间接相关。

![](/images/database-design-formula-3-1.png)
上表中，所有属性都完全依赖于学号，所以满足第二范式，但是“班主任性别”和“班主任年龄”直接依赖的是“班主任姓名”，

而不是主键“学号”，所以需做如下调整：

![](/images/database-design-formula-3-2.png)

这样以来，就满足了第三范式的要求。

ps:如果把上表中的班主任姓名改成班主任教工号可能更确切，更符合实际情况，不过只要能理解就行。

### [数据库五大约束](https://www.cnblogs.com/zhouguowei/p/9268788.html)

数据库中的五大约束包括：

1. 主键约束（Primay Key Coustraint） 唯一性，非空性；

2. 唯一约束 （Unique Counstraint）唯一性，可以空，但只能有一个；

3. 默认约束 (Default Counstraint) 该数据的默认值；

4. 外键约束 (Foreign Key Counstraint) 需要建立两表间的关系；

5. 非空约束（Not Null Counstraint）:设置非空约束，该字段不能为空。